<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>KNN Interpolation - PetroAI</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: "Poppins", sans-serif;
      background: radial-gradient(circle at center, #0a0a0a, #1a1a2e, #111827);
      color: white;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    /* ======= HEADER ======= */
    header {
      background: rgba(255, 255, 255, 0.08);
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1rem 2rem;
      box-shadow: 0 0 20px rgba(255, 255, 255, 0.1);
      position: sticky;
      top: 0;
      z-index: 100;
      backdrop-filter: blur(10px);
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .logo-icon {
      width: 32px;
      height: 32px;
      background: linear-gradient(135deg, #2563eb, #9333ea);
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .logo-text {
      font-weight: 600;
      font-size: 1.25rem;
      color: #f1f5f9;
      background: linear-gradient(90deg, #60a5fa, #9333ea);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    nav {
      display: flex;
      gap: 2rem;
    }

    nav a {
      text-decoration: none;
      color: #cbd5e1;
      font-weight: 500;
      transition: all 0.3s ease;
      padding: 0.5rem 0.75rem;
      border-radius: 6px;
      position: relative;
    }

    nav a:hover {
      color: #60a5fa;
      background-color: rgba(96, 165, 250, 0.1);
    }

    nav a::after {
      content: '';
      position: absolute;
      bottom: -2px;
      left: 0;
      width: 0;
      height: 2px;
      background: linear-gradient(90deg, #60a5fa, #9333ea);
      transition: width 0.3s ease;
    }

    nav a:hover::after {
      width: 100%;
    }

    .user-profile {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      cursor: pointer;
      padding: 0.5rem 0.75rem;
      border-radius: 8px;
      transition: all 0.3s ease;
    }

    .user-profile:hover {
      background-color: rgba(96, 165, 250, 0.1);
    }

    .user-avatar {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      background: linear-gradient(135deg, #2563eb, #9333ea);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      color: white;
    }

    .user-info {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
    }

    .user-name {
      font-weight: 500;
      font-size: 0.9rem;
    }

    .user-email {
      font-size: 0.75rem;
      color: #94a3b8;
    }

    .dropdown-menu {
      position: absolute;
      top: 100%;
      right: 2rem;
      background: rgba(31, 41, 55, 0.95);
      backdrop-filter: blur(10px);
      border-radius: 10px;
      box-shadow: 0 0 20px rgba(0, 0, 0, 0.3);
      padding: 0.5rem;
      min-width: 180px;
      display: none;
      flex-direction: column;
      z-index: 1000;
      border: 1px solid #374151;
    }

    .dropdown-menu.active {
      display: flex;
    }

    .dropdown-menu button {
      background: none;
      border: none;
      color: #cbd5e1;
      padding: 0.75rem 1rem;
      text-align: left;
      cursor: pointer;
      border-radius: 6px;
      transition: all 0.2s ease;
      font-family: "Poppins", sans-serif;
      font-size: 0.9rem;
    }

    .dropdown-menu button:hover {
      background-color: rgba(96, 165, 250, 0.1);
      color: #60a5fa;
    }

    .dropdown-divider {
      height: 1px;
      background-color: #374151;
      margin: 0.25rem 0;
    }

    /* ======= MAIN CONTENT ======= */
    .main-content {
      flex-grow: 1;
      padding: 2rem;
      max-width: 1400px;
      margin: 0 auto;
      width: 100%;
    }

    .page-header {
      text-align: center;
      margin-bottom: 2rem;
    }

    h1 {
      background: linear-gradient(90deg, #60a5fa, #9333ea);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      font-size: 2.25rem;
      margin-bottom: 0.75rem;
      font-weight: 600;
    }

    .page-subtitle {
      color: #cbd5e1;
      font-size: 1.1rem;
      margin-bottom: 1.5rem;
      opacity: 0.8;
    }

    /* ======= KNN CONTENT ======= */
    .knn-content {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1.5rem;
      margin-bottom: 2rem;
    }

    .knn-info {
      background: rgba(255, 255, 255, 0.08);
      padding: 1.5rem;
      border-radius: 12px;
      box-shadow: 0 0 20px rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.1);
      height: fit-content;
    }

    .knn-info h2 {
      color: #60a5fa;
      font-size: 1.4rem;
      margin-bottom: 1.25rem;
      font-weight: 600;
    }

    .info-section {
      margin-bottom: 1.25rem;
    }

    .info-section h3 {
      color: #60a5fa;
      font-size: 1.1rem;
      margin-bottom: 0.5rem;
      font-weight: 500;
    }

    .info-section p {
      color: #cbd5e1;
      line-height: 1.5;
      margin-bottom: 0.5rem;
      font-size: 0.9rem;
    }

    .info-section ul {
      color: #cbd5e1;
      padding-left: 1.25rem;
      line-height: 1.5;
      font-size: 0.9rem;
    }

    .info-section li {
      margin-bottom: 0.25rem;
    }

    .knn-tool {
      background: rgba(255, 255, 255, 0.08);
      padding: 1.5rem;
      border-radius: 12px;
      box-shadow: 0 0 20px rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .knn-tool h2 {
      color: #60a5fa;
      font-size: 1.4rem;
      margin-bottom: 1.25rem;
      font-weight: 600;
    }

    .upload-area {
      border: 2px dashed rgba(96, 165, 250, 0.5);
      border-radius: 8px;
      padding: 1.5rem;
      text-align: center;
      margin-bottom: 1.25rem;
      transition: all 0.3s ease;
      cursor: pointer;
    }

    .upload-area:hover {
      border-color: #60a5fa;
      background: rgba(96, 165, 250, 0.05);
    }

    .upload-area.dragover {
      border-color: #60a5fa;
      background: rgba(96, 165, 250, 0.1);
    }

    .upload-icon {
      font-size: 2.5rem;
      margin-bottom: 0.75rem;
      color: #60a5fa;
    }

    .upload-text {
      color: #cbd5e1;
      margin-bottom: 0.75rem;
      font-size: 0.9rem;
    }

    .upload-button {
      background: linear-gradient(90deg, #2563eb, #1e3a8a);
      color: white;
      border: none;
      padding: 0.6rem 1.25rem;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 500;
      transition: all 0.3s ease;
      font-family: "Poppins", sans-serif;
      font-size: 0.9rem;
    }

    .upload-button:hover {
      opacity: 0.9;
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(37, 99, 235, 0.4);
    }

    .file-name {
      color: #60a5fa;
      margin-top: 0.75rem;
      font-weight: 500;
      font-size: 0.85rem;
    }

    .column-selection {
      margin-bottom: 1.25rem;
      display: none;
    }

    .column-selection.active {
      display: block;
    }

    .parameter-group {
      margin-bottom: 0.75rem;
    }

    .parameter-group label {
      display: block;
      color: #cbd5e1;
      margin-bottom: 0.4rem;
      font-weight: 500;
      font-size: 0.9rem;
    }

    .parameter-group select,
    .parameter-group input {
      width: 100%;
      padding: 0.6rem;
      border-radius: 6px;
      border: 1px solid rgba(255, 255, 255, 0.2);
      background: rgba(255, 255, 255, 0.1);
      color: white;
      font-family: "Poppins", sans-serif;
      font-size: 0.85rem;
    }

    .parameter-group select:focus,
    .parameter-group input:focus {
      outline: none;
      border-color: #60a5fa;
      box-shadow: 0 0 0 2px rgba(96, 165, 250, 0.2);
    }

    .parameter-group select option {
      background: #1f2937;
      color: white;
    }

    .coordinates-input {
      display: none;
      margin-bottom: 1.25rem;
    }

    .coordinates-input.active {
      display: block;
    }

    .coordinates-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 0.75rem;
    }

    .auto-coordinates {
      display: flex;
      align-items: center;
      gap: 0.4rem;
      margin-top: 0.5rem;
    }

    .auto-coordinates input {
      width: auto;
    }

    .auto-coordinates label {
      color: #94a3b8;
      font-size: 0.8rem;
    }

    .run-button {
      width: 100%;
      padding: 0.85rem;
      border: none;
      border-radius: 8px;
      background: linear-gradient(90deg, #10b981, #059669);
      color: white;
      cursor: pointer;
      font-weight: 500;
      font-size: 1rem;
      transition: all 0.3s ease;
      font-family: "Poppins", sans-serif;
      margin-bottom: 1.25rem;
    }

    .run-button:hover {
      opacity: 0.9;
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(16, 185, 129, 0.4);
    }

    .run-button:disabled {
      background: linear-gradient(90deg, #6b7280, #4b5563);
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }

    .loading {
      display: none;
      text-align: center;
      margin: 0.75rem 0;
    }

    .loading.active {
      display: block;
    }

    .spinner {
      border: 3px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      border-top: 3px solid #60a5fa;
      width: 25px;
      height: 25px;
      animation: spin 1s linear infinite;
      margin: 0 auto 0.75rem;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .results {
      display: none;
    }

    .results.active {
      display: block;
    }

    .results h3 {
      color: #60a5fa;
      font-size: 1.2rem;
      margin-bottom: 0.75rem;
      font-weight: 500;
    }

    .results-content {
      background: rgba(0, 0, 0, 0.2);
      border-radius: 8px;
      padding: 1.25rem;
      margin-bottom: 1.25rem;
    }

    .results-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 0.75rem;
      margin-bottom: 0.75rem;
    }

    .result-item {
      background: rgba(255, 255, 255, 0.05);
      padding: 0.75rem;
      border-radius: 6px;
    }

    .result-label {
      color: #94a3b8;
      font-size: 0.8rem;
      margin-bottom: 0.2rem;
    }

    .result-value {
      color: #60a5fa;
      font-size: 1rem;
      font-weight: 600;
    }

    .results-table-container {
      max-height: 350px;
      overflow-y: auto;
      margin-top: 0.75rem;
      border-radius: 6px;
      background: rgba(0, 0, 0, 0.2);
    }

    .results-table {
      width: 100%;
      border-collapse: collapse;
    }

    .results-table thead {
      position: sticky;
      top: 0;
      background: #1f2937;
    }

    .results-table th,
    .results-table td {
      padding: 0.6rem;
      text-align: left;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      font-size: 0.8rem;
    }

    .results-table th {
      color: #60a5fa;
      font-weight: 500;
    }

    .results-table td {
      color: #cbd5e1;
    }

    .visualization {
      margin-top: 1.25rem;
    }

    .visualization h3 {
      color: #60a5fa;
      font-size: 1.2rem;
      margin-bottom: 0.75rem;
      font-weight: 500;
    }

    .contour-map {
      background: rgba(0, 0, 0, 0.2);
      border-radius: 8px;
      padding: 1rem;
      text-align: center;
      margin-bottom: 0.75rem;
      position: relative;
    }

    .contour-map img {
      max-width: 100%;
      border-radius: 6px;
      height: auto;
    }

    .download-buttons {
      display: none;
      gap: 0.75rem;
      justify-content: center;
      margin-top: 0.75rem;
    }

    .download-button {
      background: linear-gradient(90deg, #8b5cf6, #7c3aed);
      color: white;
      border: none;
      padding: 0.6rem 1.25rem;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 500;
      transition: all 0.3s ease;
      font-family: "Poppins", sans-serif;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      gap: 0.4rem;
      font-size: 0.85rem;
    }

    .download-button:hover {
      opacity: 0.9;
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(139, 92, 246, 0.4);
    }

    footer {
      text-align: center;
      padding: 1.25rem;
      color: #64748b;
      font-size: 0.8rem;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
      margin-top: auto;
      background: rgba(255, 255, 255, 0.05);
    }

    /* ======= RESPONSIVE DESIGN ======= */
    
    /* Tablets */
    @media (max-width: 1024px) {
      .knn-content {
        grid-template-columns: 1fr;
        gap: 1.25rem;
      }
    }

    /* Mobile phones */
    @media (max-width: 768px) {
      header {
        padding: 0.75rem 1rem;
      }
      
      nav {
        gap: 0.75rem;
      }
      
      .logo-text {
        font-size: 1rem;
      }
      
      nav a {
        padding: 0.3rem 0.5rem;
        font-size: 0.8rem;
      }
      
      .user-info {
        display: none;
      }
      
      .main-content {
        padding: 1rem;
      }
      
      .knn-info, .knn-tool {
        padding: 1.25rem;
      }
      
      h1 {
        font-size: 1.75rem;
      }
      
      .page-subtitle {
        font-size: 1rem;
      }
      
      .coordinates-grid {
        grid-template-columns: 1fr;
      }
      
      .results-grid {
        grid-template-columns: 1fr;
      }
      
      .download-buttons {
        flex-direction: column;
      }
    }

    /* Small phones */
    @media (max-width: 480px) {
      header {
        padding: 0.5rem 0.75rem;
        flex-wrap: wrap;
        gap: 0.4rem;
      }
      
      .logo {
        gap: 0.4rem;
      }
      
      .logo-icon {
        width: 24px;
        height: 24px;
      }
      
      .logo-text {
        font-size: 0.9rem;
      }
      
      nav {
        gap: 0.4rem;
        order: 3;
        width: 100%;
        justify-content: center;
        margin-top: 0.4rem;
      }
      
      nav a {
        padding: 0.25rem 0.4rem;
        font-size: 0.75rem;
      }
      
      .user-profile {
        margin-left: auto;
      }
      
      .knn-info, .knn-tool {
        padding: 1rem;
      }
      
      .upload-area {
        padding: 1.25rem;
      }
      
      .results-table th,
      .results-table td {
        padding: 0.4rem;
        font-size: 0.75rem;
      }
    }

    /* Touch device improvements */
    @media (hover: none) and (pointer: coarse) {
      .upload-button:hover, .run-button:hover {
        transform: none;
        box-shadow: none;
      }
    }
  </style>
</head>
<body>
  <!-- ======= HEADER ======= -->
  <header>
    <div class="logo">
      <div class="logo-icon">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M12 2L3 7V17L12 22L21 17V7L12 2Z" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M12 22V12" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M17 7L12 12L7 7" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </div>
      <span class="logo-text">PetroAI</span>
    </div>

    <nav>
      <a href="main.html">Home</a>
      <a href="ai.html">AI Tools</a>
      <a href="knn.html" style="color: #60a5fa;">KNN Interpolation</a>
      <a href="contact.html">Contact Us</a>
    </nav>

    <div class="user-profile" id="profileArea">
      <div class="user-avatar" id="userAvatar">U</div>
      <div class="user-info">
        <span class="user-name" id="userName">User</span>
        <span class="user-email" id="userEmail">user@example.com</span>
      </div>
      
      <div class="dropdown-menu" id="dropdownMenu">
        <button id="profileBtn">üë§ My Profile</button>
        <button id="settingsBtn">‚öôÔ∏è Settings</button>
        <div class="dropdown-divider"></div>
        <button id="privacyBtn">üîí Privacy & Security</button>
        <div class="dropdown-divider"></div>
        <button id="logoutBtn">üö™ Logout</button>
      </div>
    </div>
  </header>

  <!-- ======= MAIN CONTENT ======= -->
  <div class="main-content">
    <div class="page-header">
      <h1>KNN Interpolation</h1>
      <p class="page-subtitle">K-Nearest Neighbors interpolation for contour mapping in the oil and gas industry</p>
    </div>

    <div class="knn-content">
      <!-- Information Section -->
      <div class="knn-info">
        <h2>About KNN Interpolation</h2>
        
        <div class="info-section">
          <h3>Concept</h3>
          <p>KNN interpolation estimates unknown values by averaging the data points closest to the target location. It identifies the k nearest known samples in space and uses their values to predict the new point.</p>
        </div>
        
        <div class="info-section">
          <h3>Dependence on Distance</h3>
          <p>The method relies on spatial proximity; points that are geographically closer have more influence on the interpolated value than distant ones.</p>
        </div>
        
        <div class="info-section">
          <h3>Handling Discontinuities</h3>
          <p>KNN is effective in datasets with sharp boundaries or abrupt changes (such as fault zones or lithology transitions) because it doesn't assume smooth variation between points.</p>
        </div>
        
        <div class="info-section">
          <h3>Oil & Gas Application</h3>
          <p>In reservoir and production mapping, KNN interpolation is used to generate contour maps of:</p>
          <ul>
            <li>Pressure distribution</li>
            <li>Porosity estimation</li>
            <li>Permeability mapping</li>
            <li>Saturation analysis</li>
          </ul>
          <p>This helps engineers visualize subsurface variations and plan development strategies.</p>
        </div>
      </div>

      <!-- Tool Section -->
      <div class="knn-tool">
        <h2>KNN Interpolation Tool</h2>
        
        <div class="upload-area" id="uploadArea">
          <div class="upload-icon">üìä</div>
          <p class="upload-text">Upload your Excel data file (.xlsx)</p>
          <button class="upload-button" id="uploadButton">Choose File</button>
          <input type="file" id="fileInput" accept=".xlsx, .xls" style="display: none;">
          <p class="file-name" id="fileName">No file selected</p>
        </div>
        
        <div class="column-selection" id="columnSelection">
          <h3>Select Data Columns</h3>
          
          <div class="parameter-group">
            <label for="xColumn">X Coordinate Column</label>
            <select id="xColumn">
              <option value="">Select X column</option>
            </select>
          </div>
          
          <div class="parameter-group">
            <label for="yColumn">Y Coordinate Column</label>
            <select id="yColumn">
              <option value="">Select Y column</option>
            </select>
          </div>
          
          <div class="parameter-group">
            <label for="zColumn">Z Value Column (to interpolate)</label>
            <select id="zColumn">
              <option value="">Select Z column</option>
            </select>
          </div>
          
          <div class="parameter-group">
            <label for="wellColumn">Well Names Column (Optional)</label>
            <select id="wellColumn">
              <option value="">Select well names column</option>
            </select>
          </div>
          
          <div class="parameter-group">
            <label for="kValue">K Value (Number of Neighbors)</label>
            <input type="number" id="kValue" min="1" max="20" value="5">
          </div>
        </div>
        
        <div class="coordinates-input" id="coordinatesInput">
          <h3>Enter Target Coordinates</h3>
          <div class="coordinates-grid">
            <div class="parameter-group">
              <label for="targetX">Target X Coordinate</label>
              <input type="number" id="targetX" step="any" placeholder="Enter X coordinate">
            </div>
            
            <div class="parameter-group">
              <label for="targetY">Target Y Coordinate</label>
              <input type="number" id="targetY" step="any" placeholder="Enter Y coordinate">
            </div>
          </div>
          <div class="auto-coordinates">
            <input type="checkbox" id="autoCenter" checked>
            <label for="autoCenter">Auto-center coordinates based on data range</label>
          </div>
        </div>
        
        <button class="run-button" id="runButton" disabled>Run KNN Interpolation</button>
        
        <div class="loading" id="loading">
          <div class="spinner"></div>
          <p>Processing KNN interpolation...</p>
        </div>
        
        <div class="results" id="resultsSection">
          <h3>Interpolation Results</h3>
          <div class="results-content">
            <div class="results-grid">
              <div class="result-item">
                <div class="result-label">Interpolated Z Value</div>
                <div class="result-value" id="resultZ">-</div>
              </div>
              <div class="result-item">
                <div class="result-label">Target Location</div>
                <div class="result-value" id="resultLocation">-</div>
              </div>
              <div class="result-item">
                <div class="result-label">K Value Used</div>
                <div class="result-value" id="resultK">-</div>
              </div>
              <div class="result-item">
                <div class="result-label">Data Points</div>
                <div class="result-value" id="resultPoints">-</div>
              </div>
            </div>
            
            <h4>Nearest Neighbors</h4>
            <div class="results-table-container">
              <table class="results-table" id="neighborsTable">
                <thead>
                  <tr>
                    <th>Well Name</th>
                    <th>X Coordinate</th>
                    <th>Y Coordinate</th>
                    <th>Z Value</th>
                    <th>Distance</th>
                  </tr>
                </thead>
                <tbody>
                  <!-- Filled by JavaScript -->
                </tbody>
              </table>
            </div>
          </div>
        </div>
        
        <div class="visualization" id="visualizationSection">
          <h3>Contour Map Visualization</h3>
          <div class="contour-map" id="contourMap">
            <!-- Contour map will be displayed here -->
          </div>
          <div class="download-buttons" id="downloadButtons">
            <a href="#" class="download-button" id="downloadMap">
              <span>üì• Download Map</span>
            </a>
            <a href="#" class="download-button" id="downloadData">
              <span>üìä Download Data</span>
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>

  <footer>
    ¬© 2025 PetroAI ‚Äî All Rights Reserved
  </footer>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      // User authentication and profile management
      const userName = document.getElementById("userName");
      const userEmail = document.getElementById("userEmail");
      const userAvatar = document.getElementById("userAvatar");
      const profileArea = document.getElementById("profileArea");
      const dropdownMenu = document.getElementById("dropdownMenu");

      // KNN Tool elements
      const uploadArea = document.getElementById("uploadArea");
      const uploadButton = document.getElementById("uploadButton");
      const fileInput = document.getElementById("fileInput");
      const fileName = document.getElementById("fileName");
      const columnSelection = document.getElementById("columnSelection");
      const xColumn = document.getElementById("xColumn");
      const yColumn = document.getElementById("yColumn");
      const zColumn = document.getElementById("zColumn");
      const wellColumn = document.getElementById("wellColumn");
      const kValue = document.getElementById("kValue");
      const coordinatesInput = document.getElementById("coordinatesInput");
      const targetX = document.getElementById("targetX");
      const targetY = document.getElementById("targetY");
      const autoCenter = document.getElementById("autoCenter");
      const runButton = document.getElementById("runButton");
      const loading = document.getElementById("loading");
      const resultsSection = document.getElementById("resultsSection");
      const resultZ = document.getElementById("resultZ");
      const resultLocation = document.getElementById("resultLocation");
      const resultK = document.getElementById("resultK");
      const resultPoints = document.getElementById("resultPoints");
      const neighborsTable = document.getElementById("neighborsTable");
      const visualizationSection = document.getElementById("visualizationSection");
      const contourMap = document.getElementById("contourMap");
      const downloadButtons = document.getElementById("downloadButtons");
      const downloadMap = document.getElementById("downloadMap");
      const downloadData = document.getElementById("downloadData");

      let uploadedFile = null;
      let fileData = null;
      let currentResults = null;

      // User profile simulation
      userName.textContent = "Petro Engineer";
      userEmail.textContent = "engineer@petroai.com";
      userAvatar.textContent = "P";

      // ŸÅÿ™ÿ≠ / ÿ•ÿ∫ŸÑÿßŸÇ ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑÿ®ÿ±ŸàŸÅÿßŸäŸÑ
      profileArea.addEventListener("click", (e) => {
        e.stopPropagation();
        dropdownMenu.classList.toggle("active");
      });

      // ÿ•ÿ∫ŸÑÿßŸÇ ÿßŸÑŸÇÿßÿ¶ŸÖÿ© ÿπŸÜÿØ ÿßŸÑŸÜŸÇÿ± ÿÆÿßÿ±ÿ¨Ÿáÿß
      document.addEventListener("click", () => {
        dropdownMenu.classList.remove("active");
      });

      // ÿßŸÑÿ£ÿ≤ÿ±ÿßÿ± ÿØÿßÿÆŸÑ ÿßŸÑŸÇÿßÿ¶ŸÖÿ© ÿßŸÑŸÖŸÜÿ≥ÿØŸÑÿ©
      document.getElementById("profileBtn").addEventListener("click", () => {
        alert("üë§ Profile page coming soon!");
      });

      document.getElementById("settingsBtn").addEventListener("click", () => {
        alert("‚öôÔ∏è Settings page coming soon!");
      });

      document.getElementById("privacyBtn").addEventListener("click", () => {
        alert("üîí Your data is secure with PetroAI.");
      });

      document.getElementById("logoutBtn").addEventListener("click", () => {
        if (confirm("Are you sure you want to logout?")) {
          alert("Logged out successfully!");
        }
      });

      // KNN Tool functionality
      uploadButton.addEventListener("click", () => {
        fileInput.click();
      });

      fileInput.addEventListener("change", (e) => {
        const file = e.target.files[0];
        if (file) {
          handleFileUpload(file);
        }
      });

      uploadArea.addEventListener('dragover', (e) => {
        e.preventDefault();
        uploadArea.classList.add('dragover');
      });

      uploadArea.addEventListener('dragleave', () => {
        uploadArea.classList.remove('dragover');
      });

      uploadArea.addEventListener('drop', (e) => {
        e.preventDefault();
        uploadArea.classList.remove('dragover');
        
        const file = e.dataTransfer.files[0];
        if (file && (file.name.endsWith('.xlsx') || file.name.endsWith('.xls'))) {
          handleFileUpload(file);
        } else {
          alert('Please upload a valid Excel file (.xlsx or .xls)');
        }
      });

      async function handleFileUpload(file) {
        uploadedFile = file;
        fileName.textContent = file.name;
        
        const formData = new FormData();
        formData.append('file', file);
        
        try {
          loading.classList.add('active');
          const response = await fetch('/upload', {
            method: 'POST',
            body: formData
          });
          
          if (!response.ok) {
            let errorMessage = 'Failed to upload file';
            try {
              const errorData = await response.json();
              errorMessage = errorData.error || errorMessage;
            } catch (e) {
              errorMessage = `Server error: ${response.status}`;
            }
            throw new Error(errorMessage);
          }
          
          fileData = await response.json();
          populateColumnSelectors(fileData);
          columnSelection.classList.add('active');
          resultsSection.classList.remove('active');
          visualizationSection.style.display = 'none';
          downloadButtons.style.display = 'none';
          
          // Auto-set coordinates if enabled
          if (autoCenter.checked) {
            setAutoCoordinates(fileData);
          }
          
        } catch (error) {
          console.error('Error uploading file:', error);
          alert('Error uploading file: ' + error.message);
        } finally {
          loading.classList.remove('active');
        }
      }

      function setAutoCoordinates(data) {
        // Try to find reasonable default coordinates from preview data
        if (data.preview && data.preview.length > 0) {
          const preview = data.preview;
          let xValues = [];
          let yValues = [];
          
          // Extract X and Y values from preview
          preview.forEach(row => {
            if (row[xColumn.value] && !isNaN(row[xColumn.value])) {
              xValues.push(parseFloat(row[xColumn.value]));
            }
            if (row[yColumn.value] && !isNaN(row[yColumn.value])) {
              yValues.push(parseFloat(row[yColumn.value]));
            }
          });
          
          if (xValues.length > 0 && yValues.length > 0) {
            // Set target to center of data range
            const centerX = (Math.min(...xValues) + Math.max(...xValues)) / 2;
            const centerY = (Math.min(...yValues) + Math.max(...yValues)) / 2;
            
            targetX.value = Math.round(centerX);
            targetY.value = Math.round(centerY);
            
            checkColumnSelection();
          }
        }
      }

      function populateColumnSelectors(data) {
        // Clear existing options
        [xColumn, yColumn, zColumn, wellColumn].forEach(select => {
          select.innerHTML = '<option value="">Select column</option>';
        });
        
        // Add numeric columns to X, Y, Z selectors
        data.numeric_columns.forEach(column => {
          const option = document.createElement('option');
          option.value = column;
          option.textContent = column;
          xColumn.appendChild(option.cloneNode(true));
          yColumn.appendChild(option.cloneNode(true));
          zColumn.appendChild(option.cloneNode(true));
        });
        
        // Add all columns to well names selector
        data.all_columns.forEach(column => {
          const option = document.createElement('option');
          option.value = column;
          option.textContent = column;
          wellColumn.appendChild(option);
        });
        
        // Auto-select common column names if they exist
        const commonNames = {
          x: ['XCOORD', 'X', 'x', 'EASTING', 'easting', 'LONGITUDE', 'longitude'],
          y: ['YCOORD', 'Y', 'y', 'NORTHING', 'northing', 'LATITUDE', 'latitude'],
          z: ['PAY', 'pay', 'Z', 'z', 'VALUE', 'value', 'DEPTH', 'depth', 'THICKNESS', 'thickness'],
          well: ['WELLNAME', 'WELL', 'well', 'UID', 'ALIAS']
        };
        
        autoSelectColumn(xColumn, commonNames.x, data.all_columns);
        autoSelectColumn(yColumn, commonNames.y, data.all_columns);
        autoSelectColumn(zColumn, commonNames.z, data.all_columns);
        autoSelectColumn(wellColumn, commonNames.well, data.all_columns);
      }

      function autoSelectColumn(select, preferredNames, availableColumns) {
        for (const name of preferredNames) {
          if (availableColumns.includes(name)) {
            select.value = name;
            break;
          }
        }
      }

      // Enable coordinates input when all required columns are selected
      [xColumn, yColumn, zColumn].forEach(select => {
        select.addEventListener('change', () => {
          checkColumnSelection();
          if (autoCenter.checked && fileData) {
            setAutoCoordinates(fileData);
          }
        });
      });

      // Auto-center when checkbox is toggled
      autoCenter.addEventListener('change', () => {
        if (autoCenter.checked && fileData) {
          setAutoCoordinates(fileData);
        }
      });

      function checkColumnSelection() {
        if (xColumn.value && yColumn.value && zColumn.value) {
          coordinatesInput.classList.add('active');
          runButton.disabled = !(targetX.value && targetY.value);
        } else {
          coordinatesInput.classList.remove('active');
          runButton.disabled = true;
        }
      }

      // Enable run button when coordinates are entered
      [targetX, targetY].forEach(input => {
        input.addEventListener('input', () => {
          runButton.disabled = !(targetX.value && targetY.value && xColumn.value && yColumn.value && zColumn.value);
        });
      });

      // Run KNN interpolation
      runButton.addEventListener('click', async () => {
        if (!uploadedFile) {
          alert('Please upload a data file first');
          return;
        }

        if (!targetX.value || !targetY.value) {
          alert('Please enter target coordinates');
          return;
        }

        const formData = new FormData();
        formData.append('file', uploadedFile);
        formData.append('x_column', xColumn.value);
        formData.append('y_column', yColumn.value);
        formData.append('z_column', zColumn.value);
        formData.append('well_column', wellColumn.value || '');
        formData.append('target_x', targetX.value);
        formData.append('target_y', targetY.value);
        formData.append('n_neighbors', kValue.value);

        // Show loading state
        loading.classList.add('active');
        runButton.disabled = true;
        resultsSection.classList.remove('active');
        visualizationSection.style.display = 'none';
        downloadButtons.style.display = 'none';

        try {
          const response = await fetch('/interpolate', {
            method: 'POST',
            body: formData
          });

          if (!response.ok) {
            let errorMessage = 'Interpolation failed';
            try {
              const errorData = await response.json();
              errorMessage = errorData.error || errorMessage;
            } catch (e) {
              errorMessage = `Server error: ${response.status}`;
            }
            throw new Error(errorMessage);
          }

          const result = await response.json();
          
          if (result.success) {
            currentResults = result;
            displayResults(result);
          } else {
            throw new Error(result.error || 'Unknown error');
          }
          
        } catch (error) {
          console.error('Error during interpolation:', error);
          alert('Error during interpolation: ' + error.message);
        } finally {
          loading.classList.remove('active');
          runButton.disabled = false;
        }
      });

      function displayResults(result) {
        // Update result summary - ŸÖÿπÿßŸÑÿ¨ÿ© ÿßŸÑŸÇŸäŸÖ ÿ®ÿ¥ŸÉŸÑ ÿ¢ŸÖŸÜ
        const interpolatedValue = parseFloat(result.interpolated_value) || 0;
        resultZ.textContent = interpolatedValue.toFixed(4);
        resultLocation.textContent = `(${result.target_x}, ${result.target_y})`;
        resultK.textContent = result.n_neighbors;
        resultPoints.textContent = result.total_data_points;
        
        // Update neighbors table
        const tbody = neighborsTable.querySelector('tbody');
        tbody.innerHTML = '';
        
        result.nearest_neighbors.forEach(neighbor => {
          const row = document.createElement('tr');
          const xVal = parseFloat(neighbor.x) || 0;
          const yVal = parseFloat(neighbor.y) || 0;
          const zVal = parseFloat(neighbor.z) || 0;
          const distVal = parseFloat(neighbor.distance) || 0;
          
          row.innerHTML = `
            <td>${neighbor.well_name || 'N/A'}</td>
            <td>${xVal.toFixed(2)}</td>
            <td>${yVal.toFixed(2)}</td>
            <td>${zVal.toFixed(4)}</td>
            <td>${distVal.toFixed(4)}</td>
          `;
          tbody.appendChild(row);
        });
        
        // Display contour map
        if (result.contour_plot) {
          contourMap.innerHTML = `<img src="${result.contour_plot}" alt="KNN Contour Map" style="max-width: 100%; height: auto;">`;
          
          // Set up download buttons
          downloadMap.href = result.contour_plot;
          downloadMap.download = `contour_map_${result.target_x}_${result.target_y}.png`;
          
          // Create data download
          const csvData = convertToCSV(result);
          const blob = new Blob([csvData], { type: 'text/csv' });
          downloadData.href = URL.createObjectURL(blob);
          downloadData.download = `knn_data_${result.target_x}_${result.target_y}.csv`;
        } else {
          contourMap.innerHTML = '<p>No contour map available</p>';
        }
        
        // Show results and visualization sections
        resultsSection.classList.add('active');
        visualizationSection.style.display = 'block';
        downloadButtons.style.display = 'flex';
        
        // Scroll to results
        resultsSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
      }

      function convertToCSV(result) {
        const interpolatedValue = parseFloat(result.interpolated_value) || 0;
        const headers = ['Well Name', 'X Coordinate', 'Y Coordinate', 'Z Value', 'Distance'];
        const rows = result.nearest_neighbors.map(neighbor => {
          const xVal = parseFloat(neighbor.x) || 0;
          const yVal = parseFloat(neighbor.y) || 0;
          const zVal = parseFloat(neighbor.z) || 0;
          const distVal = parseFloat(neighbor.distance) || 0;
          
          return [
            neighbor.well_name || 'N/A',
            xVal.toFixed(4),
            yVal.toFixed(4),
            zVal.toFixed(4),
            distVal.toFixed(4)
          ];
        });
        
        // Add summary row
        rows.push(['INTERPOLATED VALUE', '', '', interpolatedValue.toFixed(4), '']);
        
        return [headers, ...rows].map(row => row.join(',')).join('\n');
      }

      // Load example data on page load for demo
      function loadExampleData() {
        targetX.value = "460000";
        targetY.value = "5795000";
        kValue.value = "5";
      }

      loadExampleData();
    });
  </script>
</body>
</html>